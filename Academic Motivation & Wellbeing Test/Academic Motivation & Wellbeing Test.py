#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Academic Psychology Questionnaire (Persian)
Created for Helya — comprehensive educational-psych dimensions
Run: python3 academic_psych_test.py
Saves results to results_academic_psych.csv (appends)
"""

import csv
import datetime
import sys

# --- تنظیمات آزمون ---
LIKERT_LABELS = {
    1: "کاملاً مخالفم",
    2: "مخالفم",
    3: "نظری ندارم / تا حدودی",
    4: "موافقم",
    5: "کاملاً موافقم"
}

# هر بعد: فهرست سوال‌ها (فارسی). تعداد سوال برابر بین ابعاد (اینجا 5 سوال در هر بعد)
DIMENSIONS = {
    "خودتنظیمی مطالعه (Self-Regulation)": [
        "۱. من برنامه روزانه مشخصی برای مطالعه دارم و به آن پایبند می‌مانم.",
        "۲. وقتی توجه‌ام پرت می‌شود، سریع آن را به تمرکز بازمی‌گردانم.",
        "۳. برای رسیدن به اهداف درسی، گام‌های کوچک و قابل اجرا تعیین می‌کنم.",
        "۴. اگر یک روش مطالعه موثر نباشد، روش‌هایم را تغییر می‌دهم.",
        "۵. در مواقعی که انگیزه‌ام کم می‌شود، راه‌هایی برای ادامهٔ مطالعه پیدا می‌کنم."
    ],
    "انگیزه و هدفمندی (Motivation & Goal Orientation)": [
        "۶. من اهداف مشخص و قابل اندازه‌گیری برای ترم/سال تحصیلی دارم.",
        "۷. بیشتر مطالعه‌ام به خاطر اهداف بلندمدت است (نه فقط نمره گرفتن).",
        "۸. وقتی پیشرفتی می‌بینم، انگیزه‌ام افزایش می‌یابد.",
        "۹. من احساس می‌کنم یادگیری برایم معنی و ارزش دارد.",
        "۱۰. به‌راحتی از کارهای درسی خسته نمی‌شوم چون هدفی دارم."
    ],
    "روش‌های یادگیری و استراتژی‌ها (Learning Strategies)": [
        "۱۱. من از خلاصه‌نویسی یا نمودارها برای مرور مطالب استفاده می‌کنم.",
        "۱۲. هنگام مطالعه، مثال‌ها و تمرین‌های عملی حل می‌کنم.",
        "۱۳. برای یادگیری مطالب، از منابع مختلف (کتاب، ویدئو، تمرین) استفاده می‌کنم.",
        "۱۴. پیش از امتحان، مطالب را با سؤالات خودم آزمایش می‌کنم.",
        "۱۵. مطالب جدید را به مباحثی که قبلاً یاد گرفته‌ام مرتبط می‌کنم."
    ],
    "مهارت‌های مدیریت زمان (Time Management)": [
        "۱۶. من زمان‌های مشخصی را برای هر درس در برنامه‌ام رزرو می‌کنم.",
        "۱۷. کارهای درسی‌ام را اولویت‌بندی می‌کنم.",
        "۱۸. معمولاً تکالیف را قبل از موعد تحویل تمام می‌کنم.",
        "۱۹. زمان خود را بین مطالعه و استراحت به‌طور مؤثر تقسیم می‌کنم.",
        "۲۰. از ابزارهایی مثل تایمر یا تقویم برای مدیریت زمان استفاده می‌کنم."
    ],
    "اضطراب امتحان و نگرانی تحصیلی (Test Anxiety)": [
        "۲۱. قبل از امتحان، اضطراب باعث می‌شود مطالب را فراموش کنم.",
        "۲۲. افکار منفی دربارهٔ شکست، عملکردم را تحت‌تأثیر قرار می‌دهد.",
        "۲۳. در شب‌های قبل از امتحان خوابم مختل می‌شود.",
        "۲۴. اضطراب باعث می‌شود امتحان را ناعادلانه دشوار ببینم.",
        "۲۵. نگرانی امتحان باعث می‌شود نتوانم تمرکز کنم."
    ],
    "شرایط و محیط مطالعه (Study Environment)": [
        "۲۶. محیط مطالعه‌ام آرام و بدون حواس‌پرتی است.",
        "۲۷. نور، میز و صندلی مناسب برای مطالعه دارم.",
        "۲۸. به راحتی به منابع مورد نیاز (کتاب، اینترنت) دسترسی دارم.",
        "۲۹. کسی یا چیزی در محیط باعث مزاحمت در مطالعه نمی‌شود.",
        "۳۰. محیط مطالعه‌ام برای تمرکز طولانی مناسب است."
    ],
    "روابط معلم-دانش‌آموز و حمایت اجتماعی (Teacher/Peer Support)": [
        "۳۱. احساس می‌کنم می‌توانم از معلم یا استاد برای کمک استفاده کنم.",
        "۳۲. همکلاسی‌هایم در مواقع نیاز کمک یا تبادل اطلاعات می‌کنند.",
        "۳۳. از بازخورد معلم برای بهبود کارم استفاده می‌کنم.",
        "۳۴. در کلاس فعالانه شرکت می‌کنم و سؤال می‌پرسم.",
        "۳۵. حمایت‌های خانوادگی باعث تسهیل یادگیریم می‌شود."
    ],
    "خودآگاهی متاکوگنی (Metacognition & Reflection)": [
        "۳۶. بعد از مطالعه زمان می‌گذارم تا بفهمم چه چیزهایی یاد گرفتم.",
        "۳۷. نقاط قوت و ضعف یادگیری خود را می‌شناسم.",
        "۳۸. بر اساس عملکرد قبلی، روش مطالعه‌ام را اصلاح می‌کنم.",
        "۳۹. قبل از یادگیری، هدف مشخصی برای جلسهٔ مطالعه تعیین می‌کنم.",
        "۴۰. من به طور منظم پیشرفت تحصیلی‌ام را ارزیابی می‌کنم."
    ]
}

# --- توابع کمکی ---
def ask_likert(question):
    """پرسش یک سؤال با مقیاس لیکرت 1-5 و اعتبارسنجی ورودی"""
    print("\n" + question)
    for k in sorted(LIKERT_LABELS.keys()):
        print(f"  {k}. {LIKERT_LABELS[k]}")
    while True:
        ans = input("پاسخ (عدد 1 تا 5): ").strip()
        if ans.lower() in ("q", "quit", "exit"):
            print("خروج از آزمون. داده‌ای ذخیره نخواهد شد.")
            sys.exit(0)
        if ans.isdigit():
            v = int(ans)
            if 1 <= v <= 5:
                return v
        print("ورودی نامعتبر. لطفاً عددی بین 1 تا 5 وارد کنید یا 'q' برای خروج.")

def categorize_percent(pct):
    """دسته‌بندی درصد به کم/متوسط/بالا"""
    if pct <= 33:
        return "پایین"
    elif pct <= 66:
        return "متوسط"
    else:
        return "بالا"

def suggestions_for_dimension(dim_name, category):
    """پیشنهادات کوتاه براساس بعد و دسته"""
    base = {
        "خودتنظیمی مطالعه (Self-Regulation)": {
            "پایین": "سعی کن برنامهٔ روزانهٔ ساده و مشخص تنظیم کنی؛ از تکنیک پومودورو و یادداشت وظایف استفاده کن.",
            "متوسط": "در حفظ پایداری تمرکز کار کن؛ موانع و زمان‌های پرت‌شدن را یادداشت کن و برای آن برنامه داشته باش.",
            "بالا": "خوبه؛ تلاش کن این مهارت را با هدف‌گذاری چالش‌های بزرگ‌تر تقویت کنی."
        },
        "انگیزه و هدفمندی (Motivation & Goal Orientation)": {
            "پایین": "اهداف کوچک و قابل اندازه‌گیری تعیین کن و پیشرفت را جشن بگیر تا انگیزه‌ات بالا برود.",
            "متوسط": "هدف‌ها را مکتوب کن و هر هفته یک بازنگری کوتاه داشته باش.",
            "بالا": "عالی؛ می‌توانی اهداف بلندمدت‌تر و ساختارهای نگه‌داشت انگیزه بسازی."
        },
        "روش‌های یادگیری و استراتژی‌ها (Learning Strategies)": {
            "پایین": "آزمایش روش‌های مختلف (خلاصه‌نویسی، تست خودی، آموزش به دیگران) مفیده؛ یکی را انتخاب کن و پیوسته تمرین کن.",
            "متوسط": "تنوع روش‌ها را بیشتر کن و بازخورد بگیر تا ببینی کدام روش برایت اثربخش‌تر است.",
            "بالا": "خوبه؛ می‌توانی روش‌ها را مستند کنی و به دیگران هم آموزش دهی."
        },
        "مهارت‌های مدیریت زمان (Time Management)": {
            "پایین": "از یک تقویم ساده و تکنیک تعیین اولویت (مثل ماتریکس آیزنهاور) استفاده کن.",
            "متوسط": "سعی کن زمان‌های بلااستفاده را شناسایی و برای مطالعهٔ فشرده استفاده کنی.",
            "بالا": "عالی؛ برنامه‌ات را برای دوره‌های بلندتر (هفته/ماه) هم توسعه بده."
        },
        "اضطراب امتحان و نگرانی تحصیلی (Test Anxiety)": {
            "پایین": "تمرین‌های آرام‌سازی تنفسی و تمرین امتحان شبیه‌سازی شده کمک می‌کند؛ در صورت شدید بودن، از مشاور کمک بگیر.",
            "متوسط": "تمرین‌های مثبت‌اندیشی و تمرین محیطی قبل از امتحان مفید است.",
            "بالا": "اضطراب پایین است؛ ادامه بده و مراقب مضامین استرس‌زا باش."
        },
        "شرایط و محیط مطالعه (Study Environment)": {
            "پایین": "محیطی امن و با کمترین حواس‌پرتی بساز؛ از هدفون حذف‌نویز یا تغییر محل استفاده کن.",
            "متوسط": "نقاط ضعف محیط را شناسایی و قدم‌های کوچک برای بهبود بردار.",
            "بالا": "خوب؛ محیط را نگه‌دار و در صورت تغییر شرایط، جایگزین مناسب بیاب."
        },
        "روابط معلم-دانش‌آموز و حمایت اجتماعی (Teacher/Peer Support)": {
            "پایین": "دنبال منابع کمکی (تدریس خصوصی، گروه‌های مطالعه) باش و با معلم در ارتباط باش.",
            "متوسط": "روابط را با گفت‌وگو و درخواست بازخورد بهبود بده.",
            "بالا": "خوبه؛ می‌توانی شبکهٔ همیار بسازی و به دیگران کمک کنی."
        },
        "خودآگاهی متاکوگنی (Metacognition & Reflection)": {
            "پایین": "بعد از هر جلسهٔ مطالعه ۵-۱۰ دقیقه بازتاب کن؛ یادداشت بردار که چه آموخته‌ای و چه سختی‌ای داشتی.",
            "متوسط": "ابزارهای پیگیری پیشرفت (دفترچه، اپ) استفاده کن تا بازخورد دقیق‌تری داشته باشی.",
            "بالا": "عالی؛ بازتاب و تنظیم استراتژی‌ها را ادامه بده و آن‌ها را مستندسازی کن."
        }
    }
    return base.get(dim_name, {}).get(category, "")

# --- اجرای آزمون ---
def run_test():
    print("آزمون روان‌شناسی تحصیلی — پاسخ‌ها را با توجه به مقیاس 1 تا 5 وارد کنید.")
    print("برای خروج در هر مرحله 'q' یا 'quit' تایپ کنید.\n")

    participant = {}
    # گرفتن اطلاعات پایه شرکت‌کننده
    participant['نام'] = input("نام (اختیاری): ").strip()
    participant['سن'] = input("سن (اختیاری): ").strip()
    participant['جنسیت'] = input("جنسیت (اختیاری): ").strip()
    print("\nشروع آزمون — لطفاً صادقانه پاسخ دهید.\n")

    # ذخیره پاسخ‌ها و محاسبه
    scores = {dim: [] for dim in DIMENSIONS.keys()}
    all_responses = []

    for dim_name, questions in DIMENSIONS.items():
        print(f"\n--- بعد: {dim_name} ---")
        for q in questions:
            v = ask_likert(q)
            scores[dim_name].append(v)
            all_responses.append({
                "dimension": dim_name,
                "question": q,
                "response": v
            })

    # محاسبه نمرات
    results = {}
    for dim_name, vals in scores.items():
        sum_score = sum(vals)
        max_score = len(vals) * 5
        pct = (sum_score / max_score) * 100  # درصد
        cat = categorize_percent(pct)
        results[dim_name] = {
            "raw": sum_score,
            "max": max_score,
            "percent": round(pct, 1),
            "category": cat
        }

    # چاپ خلاصه
    print("\n\n--- خلاصه نتایج ---")
    now = datetime.datetime.now().isoformat(sep=' ', timespec='seconds')
    print(f"زمان انجام آزمون: {now}")
    if participant.get('نام'):
        print(f"شرکت‌کننده: {participant.get('نام')}")
    if participant.get('سن'):
        print(f"سن: {participant.get('سن')}")
    if participant.get('جنسیت'):
        print(f"جنسیت: {participant.get('جنسیت')}")

    for dim_name, res in results.items():
        print(f"\n{dim_name}: {res['raw']} / {res['max']}  → {res['percent']}%  ({res['category']})")
        sugg = suggestions_for_dimension(dim_name, res['category'])
        if sugg:
            print("پیشنهاد: " + sugg)

    # ذخیره CSV (اضافه‌کردن)
    csv_filename = "results_academic_psych.csv"
    try:
        # بررسی وجود هدر یا عدم وجود فایل
        write_header = False
        try:
            with open(csv_filename, 'r', encoding='utf-8') as f:
                pass
        except FileNotFoundError:
            write_header = True

        with open(csv_filename, 'a', newline='', encoding='utf-8') as csvfile:
            fieldnames = [
                "timestamp", "name", "age", "gender",
                # برای هر بعد: raw, max, percent, category
            ]
            # اضافه کردن فیلدهای ابعادی
            for dim in DIMENSIONS.keys():
                fieldnames += [f"{dim} - raw", f"{dim} - max", f"{dim} - percent", f"{dim} - category"]

            writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
            if write_header:
                writer.writeheader()

            row = {
                "timestamp": now,
                "name": participant.get('نام', ''),
                "age": participant.get('سن', ''),
                "gender": participant.get('جنسیت', '')
            }
            for dim_name, res in results.items():
                row[f"{dim_name} - raw"] = res['raw']
                row[f"{dim_name} - max"] = res['max']
                row[f"{dim_name} - percent"] = res['percent']
                row[f"{dim_name} - category"] = res['category']

            writer.writerow(row)

        print(f"\nنتایج ذخیره شد در فایل: {csv_filename}")

    except Exception as e:
        print("خطا در ذخیره‌سازی نتایج:", e)

    print("\nپایان آزمون — ممنون از شرکت شما!")

if __name__ == "__main__":
    run_test()
